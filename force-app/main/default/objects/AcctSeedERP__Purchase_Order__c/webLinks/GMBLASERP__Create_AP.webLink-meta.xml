<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>GMBLASERP__Create_AP</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Create AP</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/connection.js&quot;)}
{!REQUIRESCRIPT(&quot;/soap/ajax/30.0/apex.js&quot;)}

function main(){

var spinner;

var showSpinner = function(){
	
	var spinDiv = document.createElement(&#39;div&#39;);
	
	var spinCSS = &#39;&#39;;
	spinCSS += &#39;background:rgba(0,0,0,.2);&#39;;
	spinCSS += &#39;background-image:url(&quot;/img/loading32.gif&quot;);&#39;;
	spinCSS += &#39;background-repeat:no-repeat;&#39;;
	spinCSS += &#39;background-attachment:fixed;&#39;;
	spinCSS += &#39;background-position:center;&#39;;
	spinCSS += &#39;position:absolute;&#39;;
	spinCSS += &#39;width:100%;&#39;;
	spinCSS += &#39;height:100%;&#39;;
	spinCSS += &#39;top:0;&#39;;
	spinCSS += &#39;left:0;&#39;;
	spinCSS += &#39;z-index:9998;&#39;;

	spinDiv.style.cssText = spinCSS;
	document.body.appendChild(spinDiv);

	spinner = spinDiv;
};

var hideSpinner = function(){

	document.body.removeChild(spinner);

};

var showError = function(error) {

	hideSpinner();
	alert(&#39;The record could not be created. &#39;+error);

};

var createRecord = function(){

	var idVendor = &quot;{!AcctSeedERP__Purchase_Order__c.AcctSeedERP__Vendor__c}&quot;;

	if(!idVendor)
	{
		hideSpinner();	
		alert(&#39;The Purchase Order must have a Vendor, in order to create an AP.&#39;);
		return;
	};

	var invoiceNumber = prompt(&quot;Enter the vendor&#39;s invoice number&quot;);
	if(invoiceNumber === null)
	{
		hideSpinner();
		return;
	}
	else if (!invoiceNumber)
	{
		hideSpinner();
		alert(&#39;An invoice number is required.&#39;);
		return;
	};

	sforce.apex.execute(&quot;GMBLASERP.gcPurchaseOrder_createAP&quot;,&quot;createAP&quot;,
		{
			idPurchaseOrder:&quot;{!AcctSeedERP__Purchase_Order__c.Id}&quot;,
			vendorInvoiceNumber:invoiceNumber
		},
		{
			onSuccess: createRecord_callback, 
			onFailure: showError
		}
	);
};

var createRecord_callback = function(result){

	window.open(&#39;/&#39;+result,&quot;_self&quot;);

};

var checkAccess = function(){

	sforce.apex.execute(&quot;GMBLASERP.gcPurchaseOrder_createAP&quot;,&quot;checkUserHasAccessToAP&quot;,
		{
			//no parameters
		},
		{
			onSuccess: checkAccess_callback, 
			onFailure: showError
		}
	);
};

var checkAccess_callback = function(accessible){

	if(accessible == &#39;true&#39;)
	{
		createRecord();
	}
	else
	{
		hideSpinner();
		alert(&#39;The current user does not have access to Accounts Payable.&#39;);
	}
};

showSpinner();
checkAccess();

};

main();</url>
</WebLink>
